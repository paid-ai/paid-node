// This file was auto-generated by Fern from our API Definition.

import * as Paid from "../../src/api/index";
import { PaidClient } from "../../src/Client";
import { mockServerPool } from "../mock-server/MockServerPool";

describe("Plans", () => {
    test("getCurrent (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new PaidClient({ token: "test", environment: server.baseUrl });

        const rawResponseBody = {
            plan: {
                id: "63fd642c-569d-44f9-8d67-5cf4944a16cc",
                name: "Pro Plan",
                description: "Professional plan with advanced features",
                type: "flat",
                pricing: {
                    PricePoints: { USD: { unitPrice: 9900, tiers: [{}] } },
                    billingFrequency: "monthly",
                    billingFrequencyCustomMonths: 1.1,
                },
                planGroupId: "a1b2c3d4-5678-90ab-cdef-1234567890ab",
                nextPlanId: "b2c3d4e5-6789-01bc-def0-2345678901bc",
                features: [
                    {
                        productName: "API Service",
                        attributeName: "api_calls",
                        pricing: {
                            eventName: "api_calls",
                            chargeType: "usage",
                            pricingModel: "flat",
                            billingFrequency: "monthly",
                        },
                        usage: { eventName: "api_calls", currentUsage: 450, limit: 1000, isUnlimited: false },
                    },
                    {
                        productName: "API Service",
                        attributeName: "data_transfer",
                        pricing: {
                            eventName: "data_transfer",
                            chargeType: "usage",
                            pricingModel: "flat",
                            billingFrequency: "monthly",
                        },
                        usage: { eventName: "data_transfer", currentUsage: 0, isUnlimited: true },
                    },
                ],
            },
            subscription: {
                orderId: "8e1c7fdf-e93b-52e5-b827-557766661111",
                orderDisplayId: "ORD-12345",
                startDate: "2024-01-01T00:00:00Z",
                endDate: "2024-12-31T23:59:59Z",
                totalUsage: 450,
            },
        };
        server.mockEndpoint().get("/plans/current").respondWith().statusCode(200).jsonBody(rawResponseBody).build();

        const response = await client.plans.getCurrent({
            customerExternalId: "customerExternalId",
        });
        expect(response).toEqual({
            plan: {
                id: "63fd642c-569d-44f9-8d67-5cf4944a16cc",
                name: "Pro Plan",
                description: "Professional plan with advanced features",
                type: "flat",
                pricing: {
                    PricePoints: {
                        USD: {
                            unitPrice: 9900,
                            tiers: [{}],
                        },
                    },
                    billingFrequency: "monthly",
                    billingFrequencyCustomMonths: 1.1,
                },
                planGroupId: "a1b2c3d4-5678-90ab-cdef-1234567890ab",
                nextPlanId: "b2c3d4e5-6789-01bc-def0-2345678901bc",
                features: [
                    {
                        productName: "API Service",
                        attributeName: "api_calls",
                        pricing: {
                            eventName: "api_calls",
                            chargeType: "usage",
                            pricingModel: "flat",
                            billingFrequency: "monthly",
                        },
                        usage: {
                            eventName: "api_calls",
                            currentUsage: 450,
                            limit: 1000,
                            isUnlimited: false,
                        },
                    },
                    {
                        productName: "API Service",
                        attributeName: "data_transfer",
                        pricing: {
                            eventName: "data_transfer",
                            chargeType: "usage",
                            pricingModel: "flat",
                            billingFrequency: "monthly",
                        },
                        usage: {
                            eventName: "data_transfer",
                            currentUsage: 0,
                            isUnlimited: true,
                        },
                    },
                ],
            },
            subscription: {
                orderId: "8e1c7fdf-e93b-52e5-b827-557766661111",
                orderDisplayId: "ORD-12345",
                startDate: "2024-01-01T00:00:00Z",
                endDate: "2024-12-31T23:59:59Z",
                totalUsage: 450,
            },
        });
    });

    test("getCurrent (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new PaidClient({ token: "test", environment: server.baseUrl });

        const rawResponseBody = {
            plan: {
                id: "id",
                name: "name",
                description: "description",
                type: "flat",
                pricing: {
                    PricePoints: { USD: { unitPrice: 9900, tiers: [{}] } },
                    billingFrequency: "monthly",
                    billingFrequencyCustomMonths: 1.1,
                },
                planGroupId: "planGroupId",
                nextPlanId: "nextPlanId",
                prevPlanId: "prevPlanId",
                features: [
                    {
                        productName: "productName",
                        attributeName: "attributeName",
                        pricing: { key: "value" },
                        usage: { currentUsage: 1, isUnlimited: true },
                    },
                ],
            },
            subscription: {
                orderId: "orderId",
                orderDisplayId: "orderDisplayId",
                startDate: "2024-01-15T09:30:00Z",
                endDate: "2024-01-15T09:30:00Z",
                totalUsage: 1,
            },
        };
        server.mockEndpoint().get("/plans/current").respondWith().statusCode(200).jsonBody(rawResponseBody).build();

        const response = await client.plans.getCurrent({
            customerExternalId: "customerExternalId",
        });
        expect(response).toEqual({
            plan: {
                id: "id",
                name: "name",
                description: "description",
                type: "flat",
                pricing: {
                    PricePoints: {
                        USD: {
                            unitPrice: 9900,
                            tiers: [{}],
                        },
                    },
                    billingFrequency: "monthly",
                    billingFrequencyCustomMonths: 1.1,
                },
                planGroupId: "planGroupId",
                nextPlanId: "nextPlanId",
                prevPlanId: "prevPlanId",
                features: [
                    {
                        productName: "productName",
                        attributeName: "attributeName",
                        pricing: {
                            key: "value",
                        },
                        usage: {
                            currentUsage: 1,
                            isUnlimited: true,
                        },
                    },
                ],
            },
            subscription: {
                orderId: "orderId",
                orderDisplayId: "orderDisplayId",
                startDate: "2024-01-15T09:30:00Z",
                endDate: "2024-01-15T09:30:00Z",
                totalUsage: 1,
            },
        });
    });

    test("getCurrent (3)", async () => {
        const server = mockServerPool.createServer();
        const client = new PaidClient({ token: "test", environment: server.baseUrl });

        const rawResponseBody = { error: {} };
        server.mockEndpoint().get("/plans/current").respondWith().statusCode(400).jsonBody(rawResponseBody).build();

        await expect(async () => {
            return await client.plans.getCurrent({
                customerExternalId: "customerExternalId",
            });
        }).rejects.toThrow(Paid.BadRequestError);
    });

    test("getCurrent (4)", async () => {
        const server = mockServerPool.createServer();
        const client = new PaidClient({ token: "test", environment: server.baseUrl });

        const rawResponseBody = { error: {} };
        server.mockEndpoint().get("/plans/current").respondWith().statusCode(403).jsonBody(rawResponseBody).build();

        await expect(async () => {
            return await client.plans.getCurrent({
                customerExternalId: "customerExternalId",
            });
        }).rejects.toThrow(Paid.ForbiddenError);
    });

    test("getCurrent (5)", async () => {
        const server = mockServerPool.createServer();
        const client = new PaidClient({ token: "test", environment: server.baseUrl });

        const rawResponseBody = { error: {} };
        server.mockEndpoint().get("/plans/current").respondWith().statusCode(404).jsonBody(rawResponseBody).build();

        await expect(async () => {
            return await client.plans.getCurrent({
                customerExternalId: "customerExternalId",
            });
        }).rejects.toThrow(Paid.NotFoundError);
    });

    test("getById (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new PaidClient({ token: "test", environment: server.baseUrl });

        const rawResponseBody = {
            id: "id",
            organizationId: "organizationId",
            planGroupId: "planGroupId",
            name: "name",
            description: "description",
            type: "flat",
            pricing: {
                PricePoints: { USD: { unitPrice: 9900, tiers: [{}] } },
                billingFrequency: "monthly",
                billingFrequencyCustomMonths: 1.1,
            },
            nextPlanId: "nextPlanId",
            prevPlanId: "prevPlanId",
            createdAt: "2024-01-15T09:30:00Z",
            updatedAt: "2024-01-15T09:30:00Z",
            planProducts: [
                {
                    id: "id",
                    organizationId: "organizationId",
                    planId: "planId",
                    productId: "productId",
                    createdAt: "2024-01-15T09:30:00Z",
                    updatedAt: "2024-01-15T09:30:00Z",
                    product: { id: "id", organizationId: "organizationId", name: "name", type: "agent", active: true },
                    planProductAttribute: [{}],
                },
            ],
        };
        server.mockEndpoint().get("/plans/planId").respondWith().statusCode(200).jsonBody(rawResponseBody).build();

        const response = await client.plans.getById("planId");
        expect(response).toEqual({
            id: "id",
            organizationId: "organizationId",
            planGroupId: "planGroupId",
            name: "name",
            description: "description",
            type: "flat",
            pricing: {
                PricePoints: {
                    USD: {
                        unitPrice: 9900,
                        tiers: [{}],
                    },
                },
                billingFrequency: "monthly",
                billingFrequencyCustomMonths: 1.1,
            },
            nextPlanId: "nextPlanId",
            prevPlanId: "prevPlanId",
            createdAt: "2024-01-15T09:30:00Z",
            updatedAt: "2024-01-15T09:30:00Z",
            planProducts: [
                {
                    id: "id",
                    organizationId: "organizationId",
                    planId: "planId",
                    productId: "productId",
                    createdAt: "2024-01-15T09:30:00Z",
                    updatedAt: "2024-01-15T09:30:00Z",
                    product: {
                        id: "id",
                        organizationId: "organizationId",
                        name: "name",
                        type: "agent",
                        active: true,
                    },
                    planProductAttribute: [{}],
                },
            ],
        });
    });

    test("getById (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new PaidClient({ token: "test", environment: server.baseUrl });

        const rawResponseBody = { error: {} };
        server.mockEndpoint().get("/plans/planId").respondWith().statusCode(403).jsonBody(rawResponseBody).build();

        await expect(async () => {
            return await client.plans.getById("planId");
        }).rejects.toThrow(Paid.ForbiddenError);
    });

    test("getById (3)", async () => {
        const server = mockServerPool.createServer();
        const client = new PaidClient({ token: "test", environment: server.baseUrl });

        const rawResponseBody = { error: {} };
        server.mockEndpoint().get("/plans/planId").respondWith().statusCode(404).jsonBody(rawResponseBody).build();

        await expect(async () => {
            return await client.plans.getById("planId");
        }).rejects.toThrow(Paid.NotFoundError);
    });

    test("getUsage (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new PaidClient({ token: "test", environment: server.baseUrl });

        const rawResponseBody = {
            data: [
                {
                    id: "550e8400-e29b-41d4-a716-446655440000",
                    eventName: "api_calls",
                    eventsQuantity: 1500,
                    startDate: "2024-01-01T00:00:00Z",
                    endDate: "2024-01-31T23:59:59Z",
                    subtotal: 50000,
                    nextBillingDate: "2024-02-01T00:00:00Z",
                    customerId: "7d0b6fce-d82a-433d-8315-c994f8f1d68d",
                    orderId: "8e1c7fdf-e93b-52e5-b827-557766661111",
                    orderLineId: "9f2d8eeg-f04c-63f6-c938-668877772222",
                    orderLineAttributeId: "0a3e9ffh-g15d-74g7-d049-779988883333",
                    createdAt: "2024-01-15T10:30:00Z",
                    updatedAt: "2024-01-15T10:30:00Z",
                    order: { id: "8e1c7fdf-e93b-52e5-b827-557766661111", displayId: "ORD-12345" },
                    orderLine: { id: "9f2d8eeg-f04c-63f6-c938-668877772222", displayId: "OL-67890" },
                },
            ],
            pagination: { limit: 100, offset: 0, total: 1, hasMore: false },
        };
        server
            .mockEndpoint()
            .get("/plans/planId/usage")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.plans.getUsage("planId", {
            externalId: "externalId",
            limit: 1,
            offset: 1,
            startTime: "2024-01-15T09:30:00Z",
            endTime: "2024-01-15T09:30:00Z",
        });
        expect(response).toEqual({
            data: [
                {
                    id: "550e8400-e29b-41d4-a716-446655440000",
                    eventName: "api_calls",
                    eventsQuantity: 1500,
                    startDate: "2024-01-01T00:00:00Z",
                    endDate: "2024-01-31T23:59:59Z",
                    subtotal: 50000,
                    nextBillingDate: "2024-02-01T00:00:00Z",
                    customerId: "7d0b6fce-d82a-433d-8315-c994f8f1d68d",
                    orderId: "8e1c7fdf-e93b-52e5-b827-557766661111",
                    orderLineId: "9f2d8eeg-f04c-63f6-c938-668877772222",
                    orderLineAttributeId: "0a3e9ffh-g15d-74g7-d049-779988883333",
                    createdAt: "2024-01-15T10:30:00Z",
                    updatedAt: "2024-01-15T10:30:00Z",
                    order: {
                        id: "8e1c7fdf-e93b-52e5-b827-557766661111",
                        displayId: "ORD-12345",
                    },
                    orderLine: {
                        id: "9f2d8eeg-f04c-63f6-c938-668877772222",
                        displayId: "OL-67890",
                    },
                },
            ],
            pagination: {
                limit: 100,
                offset: 0,
                total: 1,
                hasMore: false,
            },
        });
    });

    test("getUsage (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new PaidClient({ token: "test", environment: server.baseUrl });

        const rawResponseBody = { error: {} };
        server
            .mockEndpoint()
            .get("/plans/planId/usage")
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.plans.getUsage("planId", {
                externalId: "externalId",
            });
        }).rejects.toThrow(Paid.BadRequestError);
    });

    test("getUsage (3)", async () => {
        const server = mockServerPool.createServer();
        const client = new PaidClient({ token: "test", environment: server.baseUrl });

        const rawResponseBody = { error: {} };
        server
            .mockEndpoint()
            .get("/plans/planId/usage")
            .respondWith()
            .statusCode(403)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.plans.getUsage("planId", {
                externalId: "externalId",
            });
        }).rejects.toThrow(Paid.ForbiddenError);
    });

    test("getUsage (4)", async () => {
        const server = mockServerPool.createServer();
        const client = new PaidClient({ token: "test", environment: server.baseUrl });

        const rawResponseBody = { error: {} };
        server
            .mockEndpoint()
            .get("/plans/planId/usage")
            .respondWith()
            .statusCode(404)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.plans.getUsage("planId", {
                externalId: "externalId",
            });
        }).rejects.toThrow(Paid.NotFoundError);
    });

    test("subscribe (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new PaidClient({ token: "test", environment: server.baseUrl });

        const rawResponseBody = {
            id: "id",
            name: "name",
            description: "description",
            customerId: "customerId",
            organizationId: "organizationId",
            startDate: "startDate",
            endDate: "endDate",
            totalAmount: 1.1,
            estimatedTax: 1.1,
            billedAmountNoTax: 1.1,
            billedTax: 1.1,
            totalBilledAmount: 1.1,
            pendingBillingAmount: 1.1,
            creationState: "active",
            orderLines: [
                {
                    id: "id",
                    orderId: "orderId",
                    agentId: "agentId",
                    name: "name",
                    description: "description",
                    startDate: "startDate",
                    endDate: "endDate",
                    totalAmount: 1.1,
                    billedAmountWithoutTax: 1.1,
                    billedTax: 1.1,
                    totalBilledAmount: 1.1,
                    creationState: "active",
                    agent: { id: "id", organizationId: "organizationId", name: "name", active: true },
                    orderLineAttributes: [{}],
                },
            ],
            customer: {
                id: "id",
                organizationId: "organizationId",
                name: "name",
                externalId: "externalId",
                phone: "phone",
                employeeCount: 1.1,
                annualRevenue: 1.1,
                taxExemptStatus: "none",
                creationSource: "manual",
                creationState: "active",
                website: "website",
                billingAddress: {
                    line1: "line1",
                    line2: "line2",
                    city: "city",
                    state: "state",
                    zipCode: "zipCode",
                    country: "country",
                },
                metadata: { key: "value" },
            },
        };
        server
            .mockEndpoint()
            .post("/plans/planId/subscribe")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.plans.subscribe("planId", {
            customerExternalId: "customerExternalId",
            currency: "currency",
        });
        expect(response).toEqual({
            id: "id",
            name: "name",
            description: "description",
            customerId: "customerId",
            organizationId: "organizationId",
            startDate: "startDate",
            endDate: "endDate",
            totalAmount: 1.1,
            estimatedTax: 1.1,
            billedAmountNoTax: 1.1,
            billedTax: 1.1,
            totalBilledAmount: 1.1,
            pendingBillingAmount: 1.1,
            creationState: "active",
            orderLines: [
                {
                    id: "id",
                    orderId: "orderId",
                    agentId: "agentId",
                    name: "name",
                    description: "description",
                    startDate: "startDate",
                    endDate: "endDate",
                    totalAmount: 1.1,
                    billedAmountWithoutTax: 1.1,
                    billedTax: 1.1,
                    totalBilledAmount: 1.1,
                    creationState: "active",
                    agent: {
                        id: "id",
                        organizationId: "organizationId",
                        name: "name",
                        active: true,
                    },
                    orderLineAttributes: [{}],
                },
            ],
            customer: {
                id: "id",
                organizationId: "organizationId",
                name: "name",
                externalId: "externalId",
                phone: "phone",
                employeeCount: 1.1,
                annualRevenue: 1.1,
                taxExemptStatus: "none",
                creationSource: "manual",
                creationState: "active",
                website: "website",
                billingAddress: {
                    line1: "line1",
                    line2: "line2",
                    city: "city",
                    state: "state",
                    zipCode: "zipCode",
                    country: "country",
                },
                metadata: {
                    key: "value",
                },
            },
        });
    });

    test("subscribe (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new PaidClient({ token: "test", environment: server.baseUrl });

        const rawResponseBody = { error: {} };
        server
            .mockEndpoint()
            .post("/plans/planId/subscribe")
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.plans.subscribe("planId", {
                customerExternalId: "customerExternalId",
                currency: "currency",
            });
        }).rejects.toThrow(Paid.BadRequestError);
    });

    test("subscribe (3)", async () => {
        const server = mockServerPool.createServer();
        const client = new PaidClient({ token: "test", environment: server.baseUrl });

        const rawResponseBody = { error: {} };
        server
            .mockEndpoint()
            .post("/plans/planId/subscribe")
            .respondWith()
            .statusCode(403)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.plans.subscribe("planId", {
                customerExternalId: "customerExternalId",
                currency: "currency",
            });
        }).rejects.toThrow(Paid.ForbiddenError);
    });

    test("subscribe (4)", async () => {
        const server = mockServerPool.createServer();
        const client = new PaidClient({ token: "test", environment: server.baseUrl });

        const rawResponseBody = { error: {} };
        server
            .mockEndpoint()
            .post("/plans/planId/subscribe")
            .respondWith()
            .statusCode(404)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.plans.subscribe("planId", {
                customerExternalId: "customerExternalId",
                currency: "currency",
            });
        }).rejects.toThrow(Paid.NotFoundError);
    });

    test("unsubscribe (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new PaidClient({ token: "test", environment: server.baseUrl });

        const rawResponseBody = {
            orderId: "orderId",
            amendmentId: "amendmentId",
            version: 1,
            endDate: "2024-01-15T09:30:00Z",
            effectiveDate: "2024-01-15T09:30:00Z",
        };
        server
            .mockEndpoint()
            .post("/plans/planId/unsubscribe")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.plans.unsubscribe("planId", {
            customerExternalId: "customerExternalId",
        });
        expect(response).toEqual({
            orderId: "orderId",
            amendmentId: "amendmentId",
            version: 1,
            endDate: "2024-01-15T09:30:00Z",
            effectiveDate: "2024-01-15T09:30:00Z",
        });
    });

    test("unsubscribe (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new PaidClient({ token: "test", environment: server.baseUrl });

        const rawResponseBody = { error: {} };
        server
            .mockEndpoint()
            .post("/plans/planId/unsubscribe")
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.plans.unsubscribe("planId", {
                customerExternalId: "customerExternalId",
            });
        }).rejects.toThrow(Paid.BadRequestError);
    });

    test("unsubscribe (3)", async () => {
        const server = mockServerPool.createServer();
        const client = new PaidClient({ token: "test", environment: server.baseUrl });

        const rawResponseBody = { error: {} };
        server
            .mockEndpoint()
            .post("/plans/planId/unsubscribe")
            .respondWith()
            .statusCode(403)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.plans.unsubscribe("planId", {
                customerExternalId: "customerExternalId",
            });
        }).rejects.toThrow(Paid.ForbiddenError);
    });

    test("unsubscribe (4)", async () => {
        const server = mockServerPool.createServer();
        const client = new PaidClient({ token: "test", environment: server.baseUrl });

        const rawResponseBody = { error: {} };
        server
            .mockEndpoint()
            .post("/plans/planId/unsubscribe")
            .respondWith()
            .statusCode(404)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.plans.unsubscribe("planId", {
                customerExternalId: "customerExternalId",
            });
        }).rejects.toThrow(Paid.NotFoundError);
    });

    test("upgrade (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new PaidClient({ token: "test", environment: server.baseUrl });

        const rawResponseBody = {
            orderId: "orderId",
            amendmentId: "amendmentId",
            version: 1,
            effectiveDate: "2024-01-15T09:30:00Z",
            endedLineIds: ["endedLineIds"],
            createdLineIds: ["createdLineIds"],
            creditLineIds: ["creditLineIds"],
            prorationDetails: [
                {
                    oldAttributeId: "oldAttributeId",
                    newAttributeId: "newAttributeId",
                    creditLineId: "creditLineId",
                    oldPrice: 1.1,
                    newPrice: 1.1,
                    creditAmount: 1.1,
                    remainingDays: 1,
                    totalDaysInCycle: 1,
                },
            ],
        };
        server.mockEndpoint().post("/plans/upgrade").respondWith().statusCode(200).jsonBody(rawResponseBody).build();

        const response = await client.plans.upgrade({
            customerExternalId: "customerExternalId",
            oldPlanId: "oldPlanId",
            newPlanId: "newPlanId",
        });
        expect(response).toEqual({
            orderId: "orderId",
            amendmentId: "amendmentId",
            version: 1,
            effectiveDate: "2024-01-15T09:30:00Z",
            endedLineIds: ["endedLineIds"],
            createdLineIds: ["createdLineIds"],
            creditLineIds: ["creditLineIds"],
            prorationDetails: [
                {
                    oldAttributeId: "oldAttributeId",
                    newAttributeId: "newAttributeId",
                    creditLineId: "creditLineId",
                    oldPrice: 1.1,
                    newPrice: 1.1,
                    creditAmount: 1.1,
                    remainingDays: 1,
                    totalDaysInCycle: 1,
                },
            ],
        });
    });

    test("upgrade (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new PaidClient({ token: "test", environment: server.baseUrl });

        const rawResponseBody = { error: {} };
        server.mockEndpoint().post("/plans/upgrade").respondWith().statusCode(400).jsonBody(rawResponseBody).build();

        await expect(async () => {
            return await client.plans.upgrade({
                customerExternalId: "customerExternalId",
                oldPlanId: "oldPlanId",
                newPlanId: "newPlanId",
            });
        }).rejects.toThrow(Paid.BadRequestError);
    });

    test("upgrade (3)", async () => {
        const server = mockServerPool.createServer();
        const client = new PaidClient({ token: "test", environment: server.baseUrl });

        const rawResponseBody = { error: {} };
        server.mockEndpoint().post("/plans/upgrade").respondWith().statusCode(403).jsonBody(rawResponseBody).build();

        await expect(async () => {
            return await client.plans.upgrade({
                customerExternalId: "customerExternalId",
                oldPlanId: "oldPlanId",
                newPlanId: "newPlanId",
            });
        }).rejects.toThrow(Paid.ForbiddenError);
    });

    test("upgrade (4)", async () => {
        const server = mockServerPool.createServer();
        const client = new PaidClient({ token: "test", environment: server.baseUrl });

        const rawResponseBody = { error: {} };
        server.mockEndpoint().post("/plans/upgrade").respondWith().statusCode(404).jsonBody(rawResponseBody).build();

        await expect(async () => {
            return await client.plans.upgrade({
                customerExternalId: "customerExternalId",
                oldPlanId: "oldPlanId",
                newPlanId: "newPlanId",
            });
        }).rejects.toThrow(Paid.NotFoundError);
    });

    test("getGroupById (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new PaidClient({ token: "test", environment: server.baseUrl });

        const rawResponseBody = {
            id: "id",
            organizationId: "organizationId",
            name: "name",
            description: "description",
            createdAt: "2024-01-15T09:30:00Z",
            updatedAt: "2024-01-15T09:30:00Z",
            plans: [
                {
                    id: "id",
                    organizationId: "organizationId",
                    planGroupId: "planGroupId",
                    name: "name",
                    description: "description",
                    type: "flat",
                    pricing: { PricePoints: { USD: { unitPrice: 9900, tiers: [{}] } }, billingFrequency: "monthly" },
                    nextPlanId: "nextPlanId",
                    prevPlanId: "prevPlanId",
                    createdAt: "2024-01-15T09:30:00Z",
                    updatedAt: "2024-01-15T09:30:00Z",
                    planProducts: [{}],
                },
            ],
        };
        server
            .mockEndpoint()
            .get("/plans/planGroup/planGroupId")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.plans.getGroupById("planGroupId");
        expect(response).toEqual({
            id: "id",
            organizationId: "organizationId",
            name: "name",
            description: "description",
            createdAt: "2024-01-15T09:30:00Z",
            updatedAt: "2024-01-15T09:30:00Z",
            plans: [
                {
                    id: "id",
                    organizationId: "organizationId",
                    planGroupId: "planGroupId",
                    name: "name",
                    description: "description",
                    type: "flat",
                    pricing: {
                        PricePoints: {
                            USD: {
                                unitPrice: 9900,
                                tiers: [{}],
                            },
                        },
                        billingFrequency: "monthly",
                    },
                    nextPlanId: "nextPlanId",
                    prevPlanId: "prevPlanId",
                    createdAt: "2024-01-15T09:30:00Z",
                    updatedAt: "2024-01-15T09:30:00Z",
                    planProducts: [{}],
                },
            ],
        });
    });

    test("getGroupById (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new PaidClient({ token: "test", environment: server.baseUrl });

        const rawResponseBody = { error: {} };
        server
            .mockEndpoint()
            .get("/plans/planGroup/planGroupId")
            .respondWith()
            .statusCode(403)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.plans.getGroupById("planGroupId");
        }).rejects.toThrow(Paid.ForbiddenError);
    });

    test("getGroupById (3)", async () => {
        const server = mockServerPool.createServer();
        const client = new PaidClient({ token: "test", environment: server.baseUrl });

        const rawResponseBody = { error: {} };
        server
            .mockEndpoint()
            .get("/plans/planGroup/planGroupId")
            .respondWith()
            .statusCode(404)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.plans.getGroupById("planGroupId");
        }).rejects.toThrow(Paid.NotFoundError);
    });

    test("getGroupPlans (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new PaidClient({ token: "test", environment: server.baseUrl });

        const rawResponseBody = [
            {
                id: "id",
                name: "name",
                description: "description",
                type: "flat",
                pricing: {
                    PricePoints: { USD: { unitPrice: 9900, tiers: [{}] } },
                    billingFrequency: "monthly",
                    billingFrequencyCustomMonths: 1.1,
                },
                createdAt: "2024-01-15T09:30:00Z",
                updatedAt: "2024-01-15T09:30:00Z",
                nextPlanId: "nextPlanId",
                prevPlanId: "prevPlanId",
                features: [{ productName: "productName", attributeName: "attributeName", pricing: { key: "value" } }],
            },
        ];
        server
            .mockEndpoint()
            .get("/plans/planGroup/planGroupId/plans")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.plans.getGroupPlans("planGroupId");
        expect(response).toEqual([
            {
                id: "id",
                name: "name",
                description: "description",
                type: "flat",
                pricing: {
                    PricePoints: {
                        USD: {
                            unitPrice: 9900,
                            tiers: [{}],
                        },
                    },
                    billingFrequency: "monthly",
                    billingFrequencyCustomMonths: 1.1,
                },
                createdAt: "2024-01-15T09:30:00Z",
                updatedAt: "2024-01-15T09:30:00Z",
                nextPlanId: "nextPlanId",
                prevPlanId: "prevPlanId",
                features: [
                    {
                        productName: "productName",
                        attributeName: "attributeName",
                        pricing: {
                            key: "value",
                        },
                    },
                ],
            },
        ]);
    });

    test("getGroupPlans (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new PaidClient({ token: "test", environment: server.baseUrl });

        const rawResponseBody = { error: {} };
        server
            .mockEndpoint()
            .get("/plans/planGroup/planGroupId/plans")
            .respondWith()
            .statusCode(403)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.plans.getGroupPlans("planGroupId");
        }).rejects.toThrow(Paid.ForbiddenError);
    });

    test("getGroupPlans (3)", async () => {
        const server = mockServerPool.createServer();
        const client = new PaidClient({ token: "test", environment: server.baseUrl });

        const rawResponseBody = { error: {} };
        server
            .mockEndpoint()
            .get("/plans/planGroup/planGroupId/plans")
            .respondWith()
            .statusCode(404)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.plans.getGroupPlans("planGroupId");
        }).rejects.toThrow(Paid.NotFoundError);
    });
});
