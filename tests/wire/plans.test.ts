// This file was auto-generated by Fern from our API Definition.

import * as Paid from "../../src/api/index";
import { PaidClient } from "../../src/Client";
import { mockServerPool } from "../mock-server/MockServerPool";

describe("Plans", () => {
    test("getById (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new PaidClient({ token: "test", environment: server.baseUrl });

        const rawResponseBody = {
            id: "id",
            organizationId: "organizationId",
            planGroupId: "planGroupId",
            name: "name",
            description: "description",
            nextPlanId: "nextPlanId",
            prevPlanId: "prevPlanId",
            createdAt: "2024-01-15T09:30:00Z",
            updatedAt: "2024-01-15T09:30:00Z",
            planProducts: [
                {
                    id: "id",
                    organizationId: "organizationId",
                    planId: "planId",
                    productId: "productId",
                    createdAt: "2024-01-15T09:30:00Z",
                    updatedAt: "2024-01-15T09:30:00Z",
                    product: { id: "id", organizationId: "organizationId", name: "name", type: "agent", active: true },
                    planProductAttribute: [{}],
                },
            ],
        };
        server.mockEndpoint().get("/plans/planId").respondWith().statusCode(200).jsonBody(rawResponseBody).build();

        const response = await client.plans.getById("planId");
        expect(response).toEqual({
            id: "id",
            organizationId: "organizationId",
            planGroupId: "planGroupId",
            name: "name",
            description: "description",
            nextPlanId: "nextPlanId",
            prevPlanId: "prevPlanId",
            createdAt: "2024-01-15T09:30:00Z",
            updatedAt: "2024-01-15T09:30:00Z",
            planProducts: [
                {
                    id: "id",
                    organizationId: "organizationId",
                    planId: "planId",
                    productId: "productId",
                    createdAt: "2024-01-15T09:30:00Z",
                    updatedAt: "2024-01-15T09:30:00Z",
                    product: {
                        id: "id",
                        organizationId: "organizationId",
                        name: "name",
                        type: "agent",
                        active: true,
                    },
                    planProductAttribute: [{}],
                },
            ],
        });
    });

    test("getById (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new PaidClient({ token: "test", environment: server.baseUrl });

        const rawResponseBody = { error: {} };
        server.mockEndpoint().get("/plans/planId").respondWith().statusCode(403).jsonBody(rawResponseBody).build();

        await expect(async () => {
            return await client.plans.getById("planId");
        }).rejects.toThrow(Paid.ForbiddenError);
    });

    test("getById (3)", async () => {
        const server = mockServerPool.createServer();
        const client = new PaidClient({ token: "test", environment: server.baseUrl });

        const rawResponseBody = { error: {} };
        server.mockEndpoint().get("/plans/planId").respondWith().statusCode(404).jsonBody(rawResponseBody).build();

        await expect(async () => {
            return await client.plans.getById("planId");
        }).rejects.toThrow(Paid.NotFoundError);
    });

    test("getUsage (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new PaidClient({ token: "test", environment: server.baseUrl });

        const rawResponseBody = {
            data: [
                {
                    id: "550e8400-e29b-41d4-a716-446655440000",
                    eventName: "api_calls",
                    eventsQuantity: 1500,
                    startDate: "2024-01-01T00:00:00Z",
                    endDate: "2024-01-31T23:59:59Z",
                    subtotal: 50000,
                    nextBillingDate: "2024-02-01T00:00:00Z",
                    customerId: "7d0b6fce-d82a-433d-8315-c994f8f1d68d",
                    orderId: "8e1c7fdf-e93b-52e5-b827-557766661111",
                    orderLineId: "9f2d8eeg-f04c-63f6-c938-668877772222",
                    orderLineAttributeId: "0a3e9ffh-g15d-74g7-d049-779988883333",
                    createdAt: "2024-01-15T10:30:00Z",
                    updatedAt: "2024-01-15T10:30:00Z",
                    order: { id: "8e1c7fdf-e93b-52e5-b827-557766661111", displayId: "ORD-12345" },
                    orderLine: { id: "9f2d8eeg-f04c-63f6-c938-668877772222", displayId: "OL-67890" },
                },
            ],
            pagination: { limit: 100, offset: 0, total: 1, hasMore: false },
        };
        server
            .mockEndpoint()
            .get("/plans/planId/usage")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.plans.getUsage("planId", {
            externalId: "externalId",
            limit: 1,
            offset: 1,
            startTime: "2024-01-15T09:30:00Z",
            endTime: "2024-01-15T09:30:00Z",
        });
        expect(response).toEqual({
            data: [
                {
                    id: "550e8400-e29b-41d4-a716-446655440000",
                    eventName: "api_calls",
                    eventsQuantity: 1500,
                    startDate: "2024-01-01T00:00:00Z",
                    endDate: "2024-01-31T23:59:59Z",
                    subtotal: 50000,
                    nextBillingDate: "2024-02-01T00:00:00Z",
                    customerId: "7d0b6fce-d82a-433d-8315-c994f8f1d68d",
                    orderId: "8e1c7fdf-e93b-52e5-b827-557766661111",
                    orderLineId: "9f2d8eeg-f04c-63f6-c938-668877772222",
                    orderLineAttributeId: "0a3e9ffh-g15d-74g7-d049-779988883333",
                    createdAt: "2024-01-15T10:30:00Z",
                    updatedAt: "2024-01-15T10:30:00Z",
                    order: {
                        id: "8e1c7fdf-e93b-52e5-b827-557766661111",
                        displayId: "ORD-12345",
                    },
                    orderLine: {
                        id: "9f2d8eeg-f04c-63f6-c938-668877772222",
                        displayId: "OL-67890",
                    },
                },
            ],
            pagination: {
                limit: 100,
                offset: 0,
                total: 1,
                hasMore: false,
            },
        });
    });

    test("getUsage (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new PaidClient({ token: "test", environment: server.baseUrl });

        const rawResponseBody = { error: {} };
        server
            .mockEndpoint()
            .get("/plans/planId/usage")
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.plans.getUsage("planId", {
                externalId: "externalId",
            });
        }).rejects.toThrow(Paid.BadRequestError);
    });

    test("getUsage (3)", async () => {
        const server = mockServerPool.createServer();
        const client = new PaidClient({ token: "test", environment: server.baseUrl });

        const rawResponseBody = { error: {} };
        server
            .mockEndpoint()
            .get("/plans/planId/usage")
            .respondWith()
            .statusCode(403)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.plans.getUsage("planId", {
                externalId: "externalId",
            });
        }).rejects.toThrow(Paid.ForbiddenError);
    });

    test("getUsage (4)", async () => {
        const server = mockServerPool.createServer();
        const client = new PaidClient({ token: "test", environment: server.baseUrl });

        const rawResponseBody = { error: {} };
        server
            .mockEndpoint()
            .get("/plans/planId/usage")
            .respondWith()
            .statusCode(404)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.plans.getUsage("planId", {
                externalId: "externalId",
            });
        }).rejects.toThrow(Paid.NotFoundError);
    });

    test("getGroupById (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new PaidClient({ token: "test", environment: server.baseUrl });

        const rawResponseBody = {
            id: "id",
            organizationId: "organizationId",
            name: "name",
            description: "description",
            createdAt: "2024-01-15T09:30:00Z",
            updatedAt: "2024-01-15T09:30:00Z",
            plans: [
                {
                    id: "id",
                    organizationId: "organizationId",
                    planGroupId: "planGroupId",
                    name: "name",
                    description: "description",
                    nextPlanId: "nextPlanId",
                    prevPlanId: "prevPlanId",
                    createdAt: "2024-01-15T09:30:00Z",
                    updatedAt: "2024-01-15T09:30:00Z",
                    planProducts: [{}],
                },
            ],
        };
        server
            .mockEndpoint()
            .get("/plans/group/planGroupId")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.plans.getGroupById("planGroupId");
        expect(response).toEqual({
            id: "id",
            organizationId: "organizationId",
            name: "name",
            description: "description",
            createdAt: "2024-01-15T09:30:00Z",
            updatedAt: "2024-01-15T09:30:00Z",
            plans: [
                {
                    id: "id",
                    organizationId: "organizationId",
                    planGroupId: "planGroupId",
                    name: "name",
                    description: "description",
                    nextPlanId: "nextPlanId",
                    prevPlanId: "prevPlanId",
                    createdAt: "2024-01-15T09:30:00Z",
                    updatedAt: "2024-01-15T09:30:00Z",
                    planProducts: [{}],
                },
            ],
        });
    });

    test("getGroupById (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new PaidClient({ token: "test", environment: server.baseUrl });

        const rawResponseBody = { error: {} };
        server
            .mockEndpoint()
            .get("/plans/group/planGroupId")
            .respondWith()
            .statusCode(403)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.plans.getGroupById("planGroupId");
        }).rejects.toThrow(Paid.ForbiddenError);
    });

    test("getGroupById (3)", async () => {
        const server = mockServerPool.createServer();
        const client = new PaidClient({ token: "test", environment: server.baseUrl });

        const rawResponseBody = { error: {} };
        server
            .mockEndpoint()
            .get("/plans/group/planGroupId")
            .respondWith()
            .statusCode(404)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.plans.getGroupById("planGroupId");
        }).rejects.toThrow(Paid.NotFoundError);
    });
});
